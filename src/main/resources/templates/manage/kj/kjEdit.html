<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>input</title>
<!-- 1 bootstrap基础css -->
<link href="../libs/bootstrap-3.3.7-dist/css/bootstrap.css"
	rel="stylesheet">
<!-- 2 table表格css -->
<link href="../libs/bootstrap-3.3.7-dist/css/bootstrap-table.min.css"
	rel="stylesheet">
<!-- 3 treeview树css -->
<link href="../libs/bootstrap-3.3.7-dist/css/bootstrap-treeview.min.css"
	rel="stylesheet">
<!-- 4 datetimepicker时间选择css -->
<link
	href="../libs/bootstrap-3.3.7-dist/css/bootstrap-datetimepicker.min.css"
	rel="stylesheet">
<!-- 5 select选择框css -->
<link href="../libs/bootstrap-3.3.7-dist/css/bootstrap-select.css"
	rel="stylesheet">
<!-- 6 fileinput上传文件css -->
<link href="../libs/bootstrap-3.3.7-dist/css/fileinput.min.css"
	rel="stylesheet">
<!-- 7 icheck单选+多选css -->
<link href="../libs/bootstrap-3.3.7-dist/css/icheck-blue.css"
	rel="stylesheet">
<!-- 8 Validator验证css -->
<link href="../libs/bootstrap-3.3.7-dist/css/bootstrapValidator.min.css"
	rel="stylesheet">
<!-- 9 layer弹框css -->
<link href="../libs/layer/layer-new.css" rel="stylesheet">
<!-- 10 引入字体css -->
<link href="../libs/bootstrap-3.3.7-dist/fonts/iconfont.css"
	rel="stylesheet">
<!-- 11 页面样式css -->
<link href="../src/css/pt-main.css" rel="stylesheet">

<!-- 优先引入jquery1.12.4版本 -->
<script src="../libs/jquery/jquery-1.12.4.js"></script>
<!-- 1 bootstrap基础js -->
<script src="../libs/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
<!-- 2 table表格js -->
<script src="../libs/bootstrap-3.3.7-dist/js/bootstrap-table.min.js"></script>
<!-- 2 table列表数据js 可删除？ -->
<script src="../libs/bootstrap-3.3.7-dist/js/bootstrap-table-data.js"></script>
<!-- 3 treeview树js -->
<script src="../libs/bootstrap-3.3.7-dist/js/bootstrap-treeview.js"></script>
<!-- 4 datetimepicker时间选择js -->
<script
	src="../libs/bootstrap-3.3.7-dist/js/bootstrap-datetimepicker.js"></script>
<!-- 5 select选择框js -->
<script src="../libs/bootstrap-3.3.7-dist/js/bootstrap-select.min.js"></script>
<!-- 6 fileinput上传文件js -->
<script src="../libs/bootstrap-3.3.7-dist/js/fileinput.min.js"></script>
<!-- 6 fileinput中文包js -->
<script src="../libs/bootstrap-3.3.7-dist/js/fileinput_locale_zh.js"></script>
<!-- 7 icheck单选+多选js -->
<script src="../libs/bootstrap-3.3.7-dist/js/icheck.min.js"></script>
<!-- 8 Validator验证js -->
<script src="../libs/bootstrap-3.3.7-dist/js/bootstrapValidator.min.js"></script>
<!-- 9 layer弹框js -->
<script src="../libs/layer/layer.js"></script>
<!-- 11 页面js -->
<script src="../src/js/main.js"></script>
<style>
html {
	overflow-x: hidden;
	overflow-y: auto;
}
</style>
</head>
<body>
	<br>
	<div class="container">
		<div class="row clearfix">
			<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 column">
				<form class="form-horizontal pt-form-full" role="form" id="form">
					<input type="hidden" name="id" id="objId"> <input
						type="hidden" name="ids" id="ids"> <input type="hidden"
						name="kjCatNames" id="kjCatNames">
					<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
						<div class="form-group">
							<label class="col-lg-2 col-md-2 col-sm-2 col-xs-6" for="title"><span>
									※ </span>课件名称</label>
							<div class="col-lg-8 col-md-8 col-sm-8 col-xs-6">
								<input type="text" class="form-control" name="kjName"
									id="kjName" />
							</div>
						</div>
					</div>
					<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
						<div class="form-group">
							<label class="col-lg-2 col-md-2 col-sm-2 col-xs-6" for="dingjia"><span>
									※ </span>选择分类</label>
							<div class="col-lg-8 col-md-8 col-sm-8 col-xs-6">
								<select id="kjCatId" name="kjCatId" class="selectpicker"
									onchange="classify()" title="请选择">
									<option value="1">法规类</option>
									<option value="2">政策类</option>
									<option value="3">收费类</option>
									<option value="4">放行类</option>
									<option value="5">理货类</option>
									<option value="6">出口类</option>
									<option value="7">进口类</option>
								</select>
							</div>
						</div>
					</div>
					<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
						<div class="form-group">
							<label class="col-lg-2 col-md-2 col-sm-2 col-xs-6" for="title"><span>
									※ </span>学&emsp;&emsp;分</label>
							<div class="col-lg-8col-md-8 col-sm-8 col-xs-6">
								<input type="text" class="form-control" name="score" id="score" />
							</div>
						</div>
					</div>
					<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
						<div class="form-group">
							<label class="col-lg-2 col-md-2 col-sm-2 col-xs-6" for="biaozhun">
								<span> ※ </span>过期时间
							</label>
							<div
								class="date datetimepicker col-lg-8col-md-8 col-sm-8 col-xs-6"
								data-date="12-02-2012" data-date-format="dd-mm-yyyy">
								<input class="form-control" name="expireDate" id="expireDate"
									size="16" type="text" value=""> <span class="add-on"><i
									class="icon-th"></i></span>
							</div>
						</div>
					</div>
					<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
						<div class="form-group">
							<label class="col-lg-2 col-md-2 col-sm-2 col-xs-6" for="biaozhun"><span>
									※ </span>说&emsp;&emsp;明</label>
							<div class="col-lg-8col-md-8 col-sm-8 col-xs-6">
								<textarea id="remarks" class="form-control" name="remarks"
									style="min-height: 108px"></textarea>
							</div>
						</div>
					</div>
					<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
						<div class="form-group">
							<label class="col-lg-2 col-md-2 col-sm-2 col-xs-6" for="wenjian"><span
								class="cfff"> ※ </span>文件选择</label>
							<div class="col-lg-8col-md-8 col-sm-8 col-xs-6">
								<label class="radio-inline"> <input type="radio"
									name="wenjian" id="wenjian" value="option1" checked>
									选择文件
								</label> <label class="radio-inline"> <input type="radio"
									name="wenjian" id="wenjian2" value="option2">
									录入新文件(录入新文件时显示下方内容)
								</label>
							</div>
						</div>
					</div>
					<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 disnone Bshow">
						<div class="form-group">
							<div class="col-lg-2 col-md-2 col-sm-2 col-xs-6"></div>
							<div class="col-lg-8col-md-8 col-sm-8 col-xs-6">
								<input id="file-1" type="file" multiple class="file"
									name="files" data-overwrite-initial="false"
									data-min-file-count="2">
							</div>
						</div>
					</div>
					<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
						<div class="form-group">
							<div class="col-lg-10 col-md-10 col-sm-10 col-xs-6">
								<table class="table table-striped" id="theTable">
									<tr>
										<th>课件名称</th>
										<th>分类名称</th>
										<th>学分</th>
										<th>过期时间</th>
										<th><span class="glyphicon glyphicon-plus"
											aria-hidden="true" onclick="selectItem()"></span></th>
									</tr>
								</table>
							</div>
						</div>
					</div>
					<div class="form-group pt-btn-submit-layer">
						<button type="submit" onclick="addKj()" id="baocun"
							class="btn w160 btn-lg btn-default btn-primary">保存</button>
						<button type="button" class="btn w160 btn-lg btn-default"
							onclick="closeMy()">取消</button>
					</div>
				</form>
			</div>
		</div>
	</div>
	<br>
	<br>
	<br>
	<script>
    $(function() {
      $("input:radio[name='wenjian']").bind('click', function() {
        console.log($(this).attr('value'))
      })
      $('form').bootstrapValidator({
        message : 'This value is not valid',
        feedbackIcons : {
          valid : 'glyphicon glyphicon-ok',
          invalid : 'glyphicon glyphicon-remove',
          validating : 'glyphicon glyphicon-refresh'
        },
        fields : {
          name : {
            message : '模拟实操名称验证失败',
            validators : {
              notEmpty : {
                message : '模拟实操名称不能为空'
              }
            }
          },
          reg : {
            validators : {
              notEmpty : {
                message : '用户名不能为空'
              },
              stringLength : {
                min : 6,
                max : 18,
                message : '用户名长度必须在6到18位之间'
              },
              regexp : {
                regexp : /^[a-zA-Z0-9_]+$/,
                message : '用户名只能包含大写、小写、数字和下划线'
              }
            }
          },
          dingjia : {
            message : '定价形式验证失败',
            validators : {
              notEmpty : {
                message : '定价形式不能为空'
              }
            }
          },
          dingjia2 : {
            message : '定价形式验证失败',
            validators : {
              notEmpty : {
                message : '定价形式不能为空'
              }
            }
          },
          biaozhun : {
            message : '服务内容及标准验证失败',
            validators : {
              notEmpty : {
                message : '服务内容及标准不能为空'
              }
            }
          }
        }
      });

      // 时间选择
      $('.datetimepicker').datetimepicker({
        language : 'zh', // 语言选择
        format : 'yyyy-mm-dd hh:ii:ss', // 选择格式
        todayBtn : true,
        autoclose : true
      });
      $('.aaa .datetimepicker-dropdown-bottom-right').css('margin-top', '0px')
      //icheck 单选多选
      $('input').iCheck({
        checkboxClass : 'icheckbox_square-blue',
        radioClass : 'iradio_square-blue',
        increaseArea : '20%' // optional
      });
      $("input:radio[name='wenjian']").on('ifChecked', function(event) {
        // alert($(this).val());
        if ($(this).val() == 'option1') {
          $('.Bshow').addClass('disnone')
        } else {
          $('.Bshow').removeClass('disnone')
        }
      });
      //获取参数
      var url = location.search;
      if (url != '') {
        alert("修改");
        //变成修改
        $("#baocun").attr("onclick", "editKj()");
        url = url.substr(1);
        var split = url.split("=");
        $.ajax({
          type : 'post',
          url : "/kj/get",
          data : {
            "id" : split[1]
          },
          dataType : 'json',
          cache : false,
          success : function(data) {
            var html = '<tr>'
              + '<th>课件名称</th>'
              + '<th>分类名称</th>'
              + '<th>学分</th>'
              + '<th>过期时间</th>'
              + '<th><span class="glyphicon glyphicon-plus" aria-hidden="true" onclick="selectItem()"></span></th>'
              + '</tr>';
            var kj = data.data;
            $("#objId").val(kj.id);
            $("#kjName").val(kj.kjName);
            $("#expireDate").val(kj.expireDate);
            $("#score").val(kj.score);
            $("#remarks").val(kj.remarks);
            $("#kjCatNames").val(kj.kjCatNames);
            $("#kjCatId").selectpicker('val', kj.kjCatId);
            $("#kjCatId").selectpicker('text', kj.kjCatNames);
            //获取相关课件列表
            $("#ids").val(kj.ids);
            var dataList = kj.kjs;
            for (var i = 0; i < dataList.length; i++) {
              html += '<tr>'
                  + '<td>'
                  + dataList[i].kjName
                  + '</td>'
                  + '<td>'
                  + dataList[i].kjCatNames
                  + '</td>'
                  + '<td>'
                  + dataList[i].score
                  + '</td>'
                  + '<td>'
                  + dataList[i].expireDate
                  + '</td>'
                  + '<th onclick="removeTr(this)"><span class="glyphicon glyphicon-minus" aria-hidden="true"></span></th>'
                  + '</tr>';
            }
            $("#theTable").html(html);
          },
          error : function() { //失败回调函数
            alert("获取信息失败");
          }
        });
      }
    });
    function addKj() {
      $.ajax({
        type : 'post',
        url : "/kj/insert",
        data : $("#form").serialize(),
        dataType : 'json',
        cache : false,
        success : function(data) {
          parent.refresh();
          closeMy();
        },
        error : function() { //失败回调函数
          parent.refresh();
          closeMy();
        }
      });
    }
    function editKj() {
      $.ajax({
        type : 'post',
        url : "/kj/update",
        data : $("#form").serialize(),
        dataType : 'json',
        cache : false,
        success : function(data) {
          parent.refresh();
          closeMy();
        },
        error : function() { //失败回调函数
          parent.refresh();
          closeMy();
        }
      });
    }
    function closeMy() {
      var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
      parent.layer.close(index); //再执行关闭
    }
    //选择分类
    function classify() {
      var kjCatNames = $('#kjCatId option:selected').text();//选中的值
      $("#kjCatNames").val(kjCatNames);
    }
    //上传文件
    $("#file-1").fileinput({
      uploadUrl : '/file/upLoad', // you must set a valid URL here else you will get an error
      // allowedFileExtensions : ['jpg', 'png','gif'],
      overwriteInitial : false,
      maxFileSize : 1000,
      maxFilesNum : 10,
      //allowedFileTypes: ['image', 'video', 'flash'],
      slugCallback : function(filename) {
        return filename.replace('(', '_').replace(']', '_');
      }
    });
    function selectItem() {
      layer.open({
        type : 2,//0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
        title : '<span class="text-color">选择课件列表</span>',//请修改span中间的内容
        shadeClose : true,//开启阴影关闭
        closeBtn : 1, //不显示关闭按钮
        shade : 0.6,
        maxmin : false,//开启最大化最小化按钮
        area : [ '80%', '80%' ],//此处可以改为100%，该数值按UI图比例算出
        content : '/kjSelList'//如果不想出现滚动条['content.html', 'no']
      });
    }

    //把选择的课件列表放到表格中
    function setKj(ids) {
      alert(ids);
      var kjIds = $("#ids").val();
      if (kjIds == '') {
        kjIds = ids;
      } else {
        var kjid = '';
        var split = ids.split(",");
        for (var i = 0; i < split.length; i++) {
          var id = split[i];
          if (kjIds.indexOf(id) == -1) {
            kjid += "," + id;
          }
        }
        kjIds = kjIds + kjid;
      }
      $("#ids").val(kjIds);
      //处理显示
      $.ajax({
        type : 'post',
        url : "/kj/getDataList",
        data : {
          "ids" : kjIds
        },
        dataType : 'json',
        cache : false,
        success : function(data) {
          var html = '<tr>'
            + '<th>课件名称</th>'
            + '<th>分类名称</th>'
            + '<th>学分</th>'
            + '<th>过期时间</th>'
            + '<th><span class="glyphicon glyphicon-plus" aria-hidden="true" onclick="selectItem()"></span></th>'
            + '</tr>';
          var dataList = data.dataList;
          for (var i = 0; i < dataList.length; i++) {
            html += '<tr>'
                + '<td>'
                + dataList[i].kjName
                + '</td>'
                + '<td>'
                + dataList[i].kjCatNames
                + '</td>'
                + '<td>'
                + dataList[i].score
                + '</td>'
                + '<td>'
                + dataList[i].expireDate
                + '</td>'
                + '<th onclick="removeTr(this)"><span class="glyphicon glyphicon-minus" aria-hidden="true"></span></th>'
                + '</tr>';
          }
          $("#theTable").html(html);
        },
        error : function() { //失败回调函数
          alert("查询失败")
        }
      });
    }
    //删除一整行
    function removeTr(obj) {
      $(obj).parent().remove();
    }
  </script>
</body>
</html>