<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>列表页</title>
<!-- 1 bootstrap基础css -->
<link href="${gateway}/libs/bootstrap-3.3.7-dist/css/bootstrap.css"
	rel="stylesheet">
<!-- 2 table表格css -->
<link
	href="${gateway}/libs/bootstrap-3.3.7-dist/css/bootstrap-table.min.css"
	rel="stylesheet">
<!-- 3 treeview树css -->
<link
	href="${gateway}/libs/bootstrap-3.3.7-dist/css/bootstrap-treeview.min.css"
	rel="stylesheet">
<!-- 4 datetimepicker时间选择css -->
<link
	href="${gateway}/libs/bootstrap-3.3.7-dist/css/bootstrap-datetimepicker.min.css"
	rel="stylesheet">
<!-- 5 select选择框css -->
<link
	href="${gateway}/libs/bootstrap-3.3.7-dist/css/bootstrap-select.css"
	rel="stylesheet">
<!-- 6 fileinput上传文件css -->
<link href="${gateway}/libs/bootstrap-3.3.7-dist/css/fileinput.min.css"
	rel="stylesheet">
<!-- 7 icheck单选+多选css -->
<link href="${gateway}/libs/bootstrap-3.3.7-dist/css/icheck-blue.css"
	rel="stylesheet">
<!-- 8 Validator验证css -->
<link
	href="${gateway}/libs/bootstrap-3.3.7-dist/css/bootstrapValidator.min.css"
	rel="stylesheet">
<!-- 9 layer弹框css -->
<link href="${gateway}/libs/layer/layer-new.css" rel="stylesheet">
<!-- 10 引入字体css -->
<link href="${gateway}/libs/bootstrap-3.3.7-dist/fonts/iconfont.css"
	rel="stylesheet">
<!-- 11 页面样式css -->
<link href="${gateway}/src/css/pt-main.css" rel="stylesheet">

<!-- 优先引入jquery1.12.4版本 -->
<script src="${gateway}/libs/jquery/jquery-1.12.4.js"></script>
<!-- 1 bootstrap基础js -->
<script src="${gateway}/libs/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
<!-- 2 table表格js -->
<script
	src="${gateway}/libs/bootstrap-3.3.7-dist/js/bootstrap-table.min.js"></script>
<!-- 2 table列表数据js simple-table -->
<script
	src="${gateway}/libs/bootstrap-3.3.7-dist/js/bootstrap-table-data.js"></script>
<!-- 3 treeview树js -->
<script
	src="${gateway}/libs/bootstrap-3.3.7-dist/js/bootstrap-treeview.js"></script>
<!-- 4 datetimepicker时间选择js -->
<script
	src="${gateway}/libs/bootstrap-3.3.7-dist/js/bootstrap-datetimepicker.js"></script>
<!-- 5 select选择框js -->
<script
	src="${gateway}/libs/bootstrap-3.3.7-dist/js/bootstrap-select.min.js"></script>
<!-- 6 fileinput上传文件js -->
<script src="${gateway}/libs/bootstrap-3.3.7-dist/js/fileinput.min.js"></script>
<!-- 6 fileinput中文包js -->
<script
	src="${gateway}/libs/bootstrap-3.3.7-dist/js/fileinput_locale_zh.js"></script>
<!-- 7 icheck单选+多选js -->
<script src="${gateway}/libs/bootstrap-3.3.7-dist/js/icheck.min.js"></script>
<!-- 8 Validator验证js -->
<script
	src="${gateway}/libs/bootstrap-3.3.7-dist/js/bootstrapValidator.min.js"></script>
<!-- 9 layer弹框js -->
<script src="${gateway}/libs/layer/layer.js"></script>
<!-- 9 以下是覆盖layer.js中的css样式，必须放在layer.js下面 -->
<link href="${gateway}/libs/layer/layer-new.css" rel="stylesheet">
<!-- 11 页面js -->
<script src="${gateway}/src/js/main.js"></script>
<!-- <script src="${gateway}/src/js/pt-tables.js"></script> -->
<style>
.datetimepicker-dropdown-bottom-right {
	margin-top: 2px;
}
</style>
</head>
<body>
	<div class="pt-page">
		<div class="pt-root-container">
			<!--主视口 -->
			<div class="pt-view pt-open" style="padding-left: 0px;">
				<!--带横线标题-->
				<div class="pt-bread">
					<h3>模拟实操</h3>
					<!-- 添加展开按钮 -->
					<button type="button" id="ptsearchfilter"
						class="btn btn-primary pt-zkbtn">展开</button>
				</div>
				<div class="pt-main pt-padding">
					<!--搜索条-->
					<div class="pt-section-search">
						<div class="row clearfix">
							 <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 column">
								<form class="form-inline">
									<!-- 示例 input-->
									<div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
										<div class="form-group">
											<label class="col-lg-3 col-md-3 col-sm-3 col-xs-3"
												for="exampleInputName2" style="text-align:left;">名&emsp;&emsp;称</label>
											<div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
												<input type="text" class="form-control" id="mnscName"
													placeholder="名称">
											</div>
										</div>
									</div>
									<!-- 隐藏部分包裹 -->
									<span class="hiddenorshow pt-search-filter"> <!-- 示例 input-->
										<!-- 示例select -->
										<div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
											<div class="form-group">
												<label class="col-lg-3 col-md-3 col-sm-3 col-xs-3"
													for="lunch" style="text-align: center;">&emsp;分&emsp;类</label>
												<div class="col-lg-8 col-md-8 col-sm-8 col-xs-6">
													<select id="mnscCatId" class="selectpicker"
														data-actions-box="true" data-live-search="true"
														title="请选择">
														<option value="">全部</option>
                            ${optionHtml}
													</select>
												</div>
											</div>
										</div>
										<div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
											<div class="form-group">
												<label class="col-lg-3 col-md-3 col-sm-3 col-xs-3"
													for="valid" style="text-align: right;">&emsp;状&emsp;态</label>
												<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
													<select id="isvalid" name="isvalid" multiple
														autocomplete="off" class="selectpicker"
														data-actions-box="true" data-live-search="true"
														title="请选择状态">
														<option value="1">启用</option>
														<option value="0">停用</option>
													</select>
												</div>
											</div>
										</div> <!-- 示例时间选择 -->
										<div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
											<div class="form-group">
												<label class="col-lg-3 col-md-3 col-sm-3 col-xs-3"
													for="exampleInputName2" style="text-align:left;">创建时间</label>
												<div class="date col-lg-8 col-md-8 col-sm-8 col-xs-8"
													data-date-format="dd-mm-yyyy">
													<input class="form-control datetimepicker" size="16"
														type="text" value="" id="createStart"
														style="padding-left: 10px;"> <span class="add-on"
														style="height: 40px"><i class="icon-th"></i></span>
												</div>
											</div>
										</div>
										<div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
											<div class="form-group">
												<label class="col-lg-3 col-md-3 col-sm-3 col-xs-3"
													style="text-align: center">~</label>
												<div class="date  col-lg-8 col-md-8 col-sm-8 col-xs-8"
													data-date-format="dd-mm-yyyy">
													<input class="form-control datetimepicker" size="16"
														type="text" value="" id="createEnd"
														style="padding-left: 10px;"> <span class="add-on"
														style="height: 40px"><i class="icon-th"></i></span>
												</div>
											</div>
										</div>
									</span>
									<!-- 示例搜索按钮 -->
									<div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
										<div class="form-group">
											<button type="button"
												class="btn btn-default btn-primary w120" onclick="sel()">搜索</button>
										</div>
									</div>
								</form>
							</div>

							<div class="column pt-btn-line">
								<button type="button" class="btn w120 btn-default btn-primary"
									onclick="addItem()">添加</button>
								<!--
                            <button type="button" class="btn w120 btn-default">批量停用</button>
                            <button type="button" class="btn w120 btn-default">批量启用</button>
                            <button type="button" class="btn w120 btn-default btn-danger-ly">批量删除</button>-->
							</div>
						</div>
					</div>
					<!--内容区容器-->
					<div class="pt-main">
						<!--bootstrap 表格-->
						<div class="row">
							<div class="col-sm-12">
								<div class="table-wrap">
									<table id="tb_departments"></table>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!--主视口 结束-->
		</div>
	</div>
	<script src="${gateway}/src/js/pt-tree.js"></script>

	<script>
/*     //渲染分类
    $.ajax({
      type : 'post',
      url : "${gateway}/train/getCateData",
      dataType : 'json',
      cache : false,
      success : function(data) {
        var returnCode = data.returnCode;
        if (returnCode == '00') {
          var html = '<option>全部</option>';
          var msgs = data.data.list;
          for (var i = 0; i < msgs.length; i++) {
            html += '<option value="'+ msgs[i].id +'">' + msgs[i].name
                + '</option>'
          }
          $("#mnscCatId").html(html);
        } else {
          layer.msg(data.messageInfo);
        }
      },
      error : function() { //失败回调函数
        layer.msg("获取分类失败！");
      }
    }); */
    //时间选择
    $('.datetimepicker').datetimepicker({
      language : 'zh',
      format : 'yyyy-mm-dd',
      minView : "month",
      pickDate : true,
      pickTime : false,
      todayBtn : true,
      autoclose : true
    });
    //搜索扩展
    $("#ptsearchfilter").click(function() {
      $(this).text($(".hiddenorshow").is(":hidden") ? "收起" : "展开");
      $(".hiddenorshow").toggleClass('pt-search-filter');
    });
    // table
    // 2.返回操作模版[按钮颜色暂不确定]
    function operateFormatter(value, row, index) {
      var del = '';
      var edit = '';
      var isvalid = row.isvalid;
      var msg = '';
      if (isvalid == 0) {
        msg = '<span class="pt-success">启用</span>';
        edit = '<button type="button" class="RoleOfedit btn btn-xs btn-default btn-link" onclick=editItem("'
            + value + '")>修改</button>';
        del = '<button type="button" class="RoleOfdelete btn btn-xs btn-default btn-link-red" onclick=deleteItem("'
            + value + '")>删除</button>';
      } else if (isvalid == 1) {
        msg = '<span class="pt-warn">停用</span>';
        edit = '';
        del = '';
      }
      return [
          '<button type="button" class="RoleOflook btn btn-xs btn-default btn-link" onclick=lookItem("'
              + value + '")>查看</button>',
          edit,
          '<button type="button" class="RoleOfdelete btn btn-xs btn-default btn-link" onclick=updateIsvalid("'
              + row.id + '","' + row.isvalid + '")>' + msg + '</button>',
          '<button type="button" class="RoleOfdelete btn btn-xs btn-default btn-link" onclick=seeItem("'
              + row.mnscUrl + '")>预览</button>', del ].join('');
    }

    // 操作模版调用的方法
    function deleteItem(e) {
      var data = {
        "id" : e
      }
      layer.confirm("确定要删除该摸拟实操信息吗？", {
        btn : [ '确定', '取消' ]
      }, function(index) {
        $.ajax({
          type : 'post',
          url : "${gateway}/mnsc/delete",
          data : data,
          dataType : 'json',
          cache : false,
          success : function(data) {
            layer.msg("删除成功！");
            $("#tb_departments").bootstrapTable('refresh');
          },
          error : function() { //失败回调函数
            layer.msg("删除失败！");
          }
        });
      });
    }

    function addItem(e) {
      layer.open({
        type : 2,//0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
        title : '<span class="text-color">添加模拟实操信息</span>',//请修改span中间的内容
        shadeClose : true,//开启阴影关闭
        closeBtn : 1, //不显示关闭按钮
        shade : 0.6,
        maxmin : false,//开启最大化最小化按钮
        area : [ '80%', '80%' ],//此处可以改为100%，该数值按UI图比例算出
        content : '${gateway}/mnsc/edit'//如果不想出现滚动条['content.html', 'no']
      });
    }

    function editItem(e) {
      layer.open({
        type : 2,//0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
        title : '<span class="text-color">修改模拟实操信息</span>',//请修改span中间的内容
        shadeClose : true,//开启阴影关闭
        closeBtn : 1, //不显示关闭按钮
        shade : 0.6,
        maxmin : false,//开启最大化最小化按钮
        area : [ '80%', '80%' ],//此处可以改为100%，该数值按UI图比例算出
        content : '${gateway}/mnsc/edit?id=' + e//如果不想出现滚动条['content.html', 'no']
      });
    }

    function lookItem(e) {
      layer.open({
        type : 2,//0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
        title : '<span class="text-color">查看摸拟实操信息</span>',//请修改span中间的内容
        shadeClose : true,//开启阴影关闭
        closeBtn : 1, //不显示关闭按钮
        shade : 0.6,
        maxmin : false,//开启最大化最小化按钮
        area : [ '80%', '80%' ],//此处可以改为100%，该数值按UI图比例算出
        content : '${gateway}/mnsc/view?id=' + e//如果不想出现滚动条['content.html', 'no']
      });
    }

    function updateIsvalid(id, isvalid) {
      var msg = "";
      if (isvalid == 0) {
        isvalid = 1;
        msg = "启用成功！";
      } else if (isvalid == 1) {
        isvalid = 0;
        msg = "停用成功！";
      }
      var data = {
        "id" : id,
        "isvalid" : isvalid
      }
      $.ajax({
        type : 'post',
        url : "${gateway}/mnsc/update",
        data : data,
        dataType : 'json',
        cache : false,
        success : function(data) {
          layer.msg(msg);
          refresh();
        },
        error : function() { //失败回调函数
          refresh();
        }
      });
    }

    function seeItem(e) {
      window.open(e);
    }

    TableInit(queryParams).Init('${gateway}/mnsc/getPageData', [ {
      field : 'mnscName',
      title : '名称',
      sortable : false
    }, {
      field : 'mnscCatNames',
      title : '分类',
      sortable : false
    }, {
      field : 'sort',
      title : '排序',
      sortable : false
    }, {
      field : 'isvalid',
      title : '状态',
      sortable : false,
      formatter : function(value) {
        if (value == 1) {
          return '<span class="pt-success">启用</span>';
        } else if (value == 0) {
          return '<span class="pt-warn">停用</span>';
        } else {
          return '删除';
        }
      }
    }, {
      field : 'createName',
      title : '创建人',
      sortable : false
    }, {
      field : 'createdate',
      title : '创建时间',
      sortable : false
    }, {
      field : 'id',
      title : '操作',
      formatter : operateFormatter
    } ]);
    function queryParams(params) {
      var selectedValues = [];
      var count=$("#isvalid option").length;
      for(var i=0;i<count;i++){
        if ($("#isvalid").get(0).options[i].selected) {
          selectedValues.push($("#isvalid").get(0).options[i].value);
        }
      }
      var data = selectedValues.join(",");
      return {
        mnscName : $("#mnscName").val(),
        mnscCatId : $("#mnscCatId").val(),
        createStart : $("#createStart").val(),
        createEnd : $("#createEnd").val(),
        isvalid : data,
        // 使用page size分页
        limit : params.limit, //页面大小
        offset : params.offset
      //当前页数
      //页码
      };
    }
    function refresh() {
      $("#tb_departments").bootstrapTable('refresh');
    }
    //搜索
    function sel() {
      $("#tb_departments").bootstrapTable('refresh');
    }
  </script>
</body>
</html>